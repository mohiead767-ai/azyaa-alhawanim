
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø£Ø²ÙŠØ§Ø¡ Ø§Ù„Ù‡ÙˆØ§Ù†Ù… â€” Ø§Ù„Ù…ØªØ¬Ø±</title>
<style>
  :root{
    --accent:#ff6f61;
    --accent-dark:#ff4c3b;
    --bg:#fff8f5;
    --card:#ffffff;
    --muted:#666;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Segoe UI", Tahoma, Arial, sans-serif;
    background:var(--bg);
    color:#222;
    direction:rtl;
  }

  /* Header */
  header{
    background:linear-gradient(90deg,var(--accent),#ff8a75);
    color:#fff;
    padding:18px 16px;
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
  }
  .brand{
    display:flex;
    align-items:center;
    gap:12px;
    font-weight:700;
    font-size:1.35rem;
  }
  .brand .logo{
    width:46px;height:46px;border-radius:10px;
    background:#fff3f1;display:flex;align-items:center;justify-content:center;color:var(--accent);
    font-weight:800;font-size:1.2rem;
  }

  /* Search & controls */
  .controls{
    display:flex;
    gap:12px;
    align-items:center;
    flex:1;
    justify-content:center;
    min-width:280px;
  }
  .search {
    display:flex;align-items:center;background:#fff;padding:6px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.06);
    width:100%;max-width:560px;
  }
  .search input{
    border:0;outline:0;padding:8px 10px;font-size:0.95rem;width:100%;
    background:transparent;
  }
  .search button{background:var(--accent);border:0;color:#fff;padding:8px 12px;border-radius:6px;cursor:pointer}
  .actions{display:flex;gap:8px;align-items:center}
  .cart-btn{
    background:transparent;border:2px solid rgba(255,255,255,0.25);color:#fff;padding:8px 12px;border-radius:40px;cursor:pointer;
  }

  /* Layout */
  main{padding:20px 16px 80px}
  .top-row{display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap}
  .sidebar{
    width:260px;min-width:200px;
    background:var(--card);padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);
    height:max-content;
  }
  .sidebar h4{margin:0 0 10px 0}
  .sidebar label{display:flex;gap:8px;align-items:center;margin:8px 0;font-size:0.95rem}
  .main-area{flex:1}

  /* product grid */
  .products{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
    gap:18px;
    margin-top:10px;
  }
  .card{
    background:var(--card);border-radius:12px;padding:10px;text-align:center;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);transition:transform .18s,box-shadow .18s;overflow:hidden;
  }
  .card:hover{transform:translateY(-6px);box-shadow:0 12px 28px rgba(0,0,0,0.12)}
  .card img{width:100%;height:260px;object-fit:cover;border-radius:8px}
  .card h3{margin:10px 0 6px;font-size:1.05rem}
  .card p{margin:0;color:var(--muted);font-size:0.9rem}
  .price-row{display:flex;justify-content:space-between;align-items:center;margin-top:10px;gap:8px}
  .price{font-weight:700}
  .card button{background:var(--accent);border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
  .card button:hover{background:var(--accent-dark)}

  /* cart drawer */
  .drawer{
    position:fixed;left:20px;top:20px;z-index:1200;
  }
  .drawer-panel{
    width:340px;max-height:80vh;overflow:auto;background:#fff;border-radius:12px;border:2px solid var(--accent);
    padding:12px;box-shadow:0 12px 30px rgba(0,0,0,0.12);display:none;
  }
  .drawer-panel.visible{display:block}
  .cart-item{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid #eee}
  .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:8px}
  .qty-controls{display:flex;gap:6px;align-items:center}
  .small-btn{background:#f3f3f3;border:0;padding:6px 8px;border-radius:6px;cursor:pointer}

  .total-row{display:flex;justify-content:space-between;align-items:center;margin-top:12px;font-weight:700}

  /* modal product detail */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:1300}
  .overlay.visible{display:flex}
  .modal{background:#fff;border-radius:12px;padding:16px;max-width:920px;width:95%;display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .modal img{width:100%;height:420px;object-fit:cover;border-radius:8px}
  .modal h2{margin:0 0 8px}
  .modal p{color:var(--muted)}
  .modal .meta{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
  .close-btn{background:transparent;border:0;font-size:1.2rem;cursor:pointer;color:var(--muted)}

  /* footer */
  footer{background:var(--accent);color:#fff;padding:18px;text-align:center;margin-top:28px}

  /* responsive adjustments */
  @media(max-width:920px){
    .modal{grid-template-columns:1fr;max-height:90vh;overflow:auto}
    .sidebar{display:none}
    .top-row{gap:12px}
  }
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo">Ø£</div>
    <div>
      Ø£Ø²ÙŠØ§Ø¡ Ø§Ù„Ù‡ÙˆØ§Ù†Ù…<br><small style="opacity:.9">Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠØ©</small>
    </div>
  </div>

  <div class="controls">
    <div class="search" role="search" aria-label="Ø¨Ø­Ø«">
      <input id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø£Ùˆ Ù„ÙˆÙ† Ø£Ùˆ Ù†ÙˆØ¹..." oninput="debouncedSearch()" />
      <button onclick="applySearch()">Ø¨Ø­Ø«</button>
    </div>
  </div>

  <div class="actions">
    <button class="cart-btn" onclick="toggleCart()">ğŸ›’ Ø³Ù„Ø© (<span id="cartCount">0</span>)</button>
    <button class="cart-btn" onclick="openContact()">Ø§ØªØµÙ„ Ø¨Ù†Ø§</button>
  </div>
</header>

<main>
  <div class="top-row">
    <aside class="sidebar" aria-label="Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØµÙÙŠØ©">
      <h4>ØªØµÙÙŠØ© ÙˆÙØ±Ø²</h4>

      <label>
        <input type="radio" name="sort" value="popular" checked onchange="applyFilters()" /> Ø§Ù„Ø£Ø­Ø¯Ø«
      </label>
      <label>
        <input type="radio" name="sort" value="price-asc" onchange="applyFilters()" /> Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„
      </label>
      <label>
        <input type="radio" name="sort" value="price-desc" onchange="applyFilters()" /> Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰
      </label>

      <hr />

      <h4>Ø§Ù„ÙØ¦Ø§Øª</h4>
      <label><input type="checkbox" value="ÙØ³ØªØ§Ù†" onchange="applyFilters()" checked /> ÙØ³Ø§ØªÙŠÙ†</label>
      <label><input type="checkbox" value="Ø¨Ù„ÙˆØ²Ø©" onchange="applyFilters()" checked /> Ø¨Ù„ÙˆØ²Ø§Øª</label>
      <label><input type="checkbox" value="ØªÙ†ÙˆØ±Ø©" onchange="applyFilters()" checked /> ØªÙ†Ø§Ù†ÙŠØ±</label>
      <label><input type="checkbox" value="Ø·Ù‚Ù…" onchange="applyFilters()" checked /> Ø£Ø·Ù‚Ù…</label>

      <hr />

      <h4>Ø³Ø¹Ø± (â‚ª)</h4>
      <label>Ù…Ù† <input id="minPrice" type="number" value="0" min="0" style="width:90px;margin-left:6px" onchange="applyFilters()" /></label>
      <label>Ø¥Ù„Ù‰ <input id="maxPrice" type="number" value="1000" min="0" style="width:90px;margin-left:6px" onchange="applyFilters()" /></label>

      <hr />

      <button style="background:var(--accent);color:#fff;border:0;padding:8px 10px;border-radius:8px;cursor:pointer" onclick="resetFilters()">Ø¥Ø¹Ø§Ø¯Ø©</button>
    </aside>

    <section class="main-area">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
        <h2 id="resultsTitle">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
        <div style="color:var(--muted)">Ø¹Ø±Ø¶ <span id="resultsCount">0</span> Ù…Ù†ØªØ¬</div>
      </div>

      <div class="products" id="productsGrid" aria-live="polite"></div>
    </section>
  </div>
</main>

<!-- cart drawer -->
<div class="drawer">
  <div id="cartPanel" class="drawer-panel" aria-hidden="true">
    <h4>Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h4>
    <div id="cartList"></div>
    <div class="total-row">
      <div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
      <div id="cartTotal">0 â‚ª</div>
    </div>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button style="flex:1;background:var(--accent);color:#fff;border:0;padding:10px;border-radius:8px;cursor:pointer" onclick="checkout()">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
      <button style="flex:1;background:#f3f3f3;border:0;padding:10px;border-radius:8px;cursor:pointer" onclick="clearCart()">ØªÙØ±ÙŠØº Ø§Ù„Ø¹Ø±Ø¨Ø©</button>
    </div>
  </div>
</div>

<!-- Modal detail -->
<div id="overlay" class="overlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div>
      <img id="modalImg" src="" alt="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬" />
    </div>
    <div>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2 id="modalTitle">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</h2>
        <button class="close-btn" onclick="closeModal()">âœ–</button>
      </div>
      <p id="modalDesc">ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬...</p>
      <div class="meta">
        <div><strong id="modalPrice">0 â‚ª</strong></div>
        <div>
          <label>Ø§Ù„ÙƒÙ…ÙŠØ©: <input id="modalQty" type="number" value="1" min="1" style="width:70px;text-align:center" /></label>
        </div>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button style="background:var(--accent);color:#fff;border:0;padding:10px;border-radius:8px;cursor:pointer" onclick="modalAddToCart()">Ø£Ø¶Ù Ù„Ù„Ø¹Ø±Ø¨Ø©</button>
        <button style="background:#f3f3f3;border:0;padding:10px;border-radius:8px;cursor:pointer" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
</div>

<!-- Contact quick modal -->
<div id="contactModal" class="overlay" aria-hidden="true">
  <div class="modal" style="max-width:640px">
    <div style="grid-column:1/-1">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>Ø§ØªØµÙ„ Ø¨Ù†Ø§</h2>
        <button class="close-btn" onclick="closeContact()">âœ–</button>
      </div>
      <p style="color:var(--muted)">Ø§ØªØ±Ùƒ Ø±Ø³Ø§Ù„ØªÙƒ ÙˆØ³Ø£Ø¹ÙˆØ¯ Ù„Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§. (Ù†Ù…ÙˆØ°Ø¬ ØªØ¬Ø±ÙŠØ¨ÙŠ â€” ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ø®Ø§Ø¯Ù…)</p>
      <form onsubmit="event.preventDefault();alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (ØªØ¬Ø±ÙŠØ¨ÙŠ)');closeContact();">
        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <input required placeholder="Ø§Ù„Ø§Ø³Ù…" style="flex:1;padding:8px;border-radius:8px;border:1px solid #ddd" />
          <input required type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" style="flex:1;padding:8px;border-radius:8px;border:1px solid #ddd" />
        </div>
        <textarea required placeholder="Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©" style="width:100%;min-height:120px;margin-top:8px;padding:8px;border-radius:8px;border:1px solid #ddd"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button style="background:var(--accent);color:#fff;border:0;padding:10px;border-radius:8px;cursor:pointer">Ø¥Ø±Ø³Ø§Ù„</button>
          <button type="button" style="background:#f3f3f3;border:0;padding:10px;border-radius:8px;cursor:pointer" onclick="closeContact()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </form>
    </div>
  </div>
</div>

<footer>
  Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ø£Ø²ÙŠØ§Ø¡ Ø§Ù„Ù‡ÙˆØ§Ù†Ù… â€” 2025
</footer>

<script>
/* ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡Ø§ Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ±) =====
   img: Ø±ÙˆØ§Ø¨Ø· ØµÙˆØ± Ø¹Ø§Ù…Ø© â€” ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø±ÙˆØ§Ø¨Ø·Ùƒ Ø£Ùˆ ØµÙˆØ± Ù…Ø­Ù„ÙŠØ©
*/
const PRODUCTS = [
  { id:1, name:"ÙØ³ØªØ§Ù† ØµÙŠÙÙŠ Ø£Ø²Ø±Ù‚", price:120, type:"ÙØ³ØªØ§Ù†",
    img:"https://i.imgur.com/4XzN6J3.jpg",
    desc:"ÙØ³ØªØ§Ù† Ø®ÙÙŠÙ ÙˆÙ…Ø±ÙŠØ­ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„ØµÙŠÙâ€”Ù‚Ù…Ø§Ø´ ØªÙ†ÙØ³ Ø¹Ø§Ù„ÙŠ ÙˆØ¬ÙˆØ¯Ø© Ù…Ù…ØªØ§Ø²Ø©." },
  { id:2, name:"Ø¨Ù„ÙˆØ²Ø© Ø­Ø±ÙŠØ±ÙŠØ© ÙˆØ±Ø¯ÙŠØ©", price:85, type:"Ø¨Ù„ÙˆØ²Ø©",
    img:"https://i.imgur.com/y2pS1hX.jpg",
    desc:"Ø¨Ù„ÙˆØ²Ø© Ù†Ø§Ø¹Ù…Ø© Ù„Ù…Ù†Ø§Ø³Ø¨Ø§ØªÙƒ Ø§Ù„Ø®ÙÙŠÙØ© â€” Ø®Ø§Ù…Ø© Ø­Ø±ÙŠØ±ÙŠØ© Ù…Ø±ÙŠØ­Ø©." },
  { id:3, name:"ØªÙ†ÙˆØ±Ø© Ø·ÙˆÙŠÙ„Ø© Ø¨ÙŠØ¬", price:100, type:"ØªÙ†ÙˆØ±Ø©",
    img:"https://i.imgur.com/Vshj2Yo.jpg",
    desc:"ØªÙ†ÙˆØ±Ø© ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ© ØªØµÙ„Ø­ Ù„Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ù†Ø²Ù‡Ø§Øª." },
  { id:4, name:"ÙØ³ØªØ§Ù† Ø³Ù‡Ø±Ø© Ø£Ø³ÙˆØ¯", price:250, type:"ÙØ³ØªØ§Ù†",
    img:"https://i.imgur.com/Y1r7z4v.jpg",
    desc:"ÙØ³ØªØ§Ù† Ø³Ù‡Ø±Ø© Ø£Ù†ÙŠÙ‚ Ù„Ù…Ù†Ø§Ø³Ø¨Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©." },
  { id:5, name:"Ø¨Ù„ÙˆØ²Ø© ØµÙŠÙÙŠØ©", price:90, type:"Ø¨Ù„ÙˆØ²Ø©",
    img:"https://i.imgur.com/k7uK6Sj.jpg",
    desc:"Ø¨Ù„ÙˆØ²Ø© Ø®ÙÙŠÙØ© Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ø§Ø±Ø©." },
  { id:6, name:"Ø·Ù‚Ù… Ø±Ø³Ù…ÙŠ Ù†Ø³Ø§Ø¦ÙŠ", price:300, type:"Ø·Ù‚Ù…",
    img:"https://i.imgur.com/U4RZfH7.jpg",
    desc:"Ø·Ù‚Ù… Ø£Ù†ÙŠÙ‚ Ù„Ù„Ø¹Ù…Ù„ Ù…Ø¹ Ù„Ù…Ø³Ø© Ø¹ØµØ±ÙŠØ©." },
  { id:7, name:"ÙØ³ØªØ§Ù† ÙˆØ±Ø¯ÙŠ Ø£Ù†Ø«ÙˆÙŠ", price:200, type:"ÙØ³ØªØ§Ù†",
    img:"https://i.imgur.com/mXxS87Q.jpg",
    desc:"ÙØ³ØªØ§Ù† Ø±Ø³Ù…ÙŠ Ø¨Ø­ÙŠØ§ÙƒØ© Ù…Ù…ØªØ§Ø²Ø© ÙˆØ¯Ø±Ø²Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©." },
  { id:8, name:"ØªÙ†ÙˆØ±Ø© Ù‚ØµÙŠØ±Ø© Ø³ÙˆØ¯Ø§Ø¡", price:110, type:"ØªÙ†ÙˆØ±Ø©",
    img:"https://i.imgur.com/1Kb7K3p.jpg",
    desc:"ØªÙ†ÙˆØ±Ø© Ø¹ØµØ±ÙŠØ© ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ§Ù„Ø³Ù‡Ø±Ø§Øª." },
  { id:9, name:"Ø¨Ù„ÙˆØ²Ø© Ø´ÙŠÙÙˆÙ† Ø£Ø²Ø±Ù‚", price:95, type:"Ø¨Ù„ÙˆØ²Ø©",
    img:"https://i.imgur.com/0LhP4dz.jpg",
    desc:"Ø¨Ù„ÙˆØ²Ø© Ø´ÙŠÙÙˆÙ† Ø®ÙÙŠÙØ© Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ù†Ø§Ø¹Ù…Ø©." },
  { id:10, name:"Ø·Ù‚Ù… ÙƒØ§Ø¬ÙˆØ§Ù„ Ù†Ø³Ø§Ø¦ÙŠ", price:220, type:"Ø·Ù‚Ù…",
    img:"https://i.imgur.com/8wZ2fVd.jpg",
    desc:"Ø·Ù‚Ù… ÙŠÙˆÙ…ÙŠ Ù…Ø±ÙŠØ­ ÙˆØ£Ù†ÙŠÙ‚ Ù„Ù„Ø±Ø§Ø­Ø© ÙˆØ§Ù„Ø´ÙƒÙ„." }
];

let state = {
  products: [...PRODUCTS],
  cart: [], // {id, name, price, qty, img}
  filters:{
    q:"",
    cats: new Set(["ÙØ³ØªØ§Ù†","Ø¨Ù„ÙˆØ²Ø©","ØªÙ†ÙˆØ±Ø©","Ø·Ù‚Ù…"]),
    minPrice:0, maxPrice:1000,
    sort:"popular"
  }
};

/* ===== Ø±Ù†Ø¯Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ===== */
const grid = document.getElementById('productsGrid');
const resultsTitle = document.getElementById('resultsTitle');
const resultsCount = document.getElementById('resultsCount');

function renderProducts(list){
  grid.innerHTML = "";
  if(list.length===0){
    resultsTitle.textContent="Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬";
    resultsCount.textContent=0;
    grid.innerHTML = `<div style="padding:30px;background:#fff;border-radius:10px;text-align:center;color:var(--muted)">Ø­Ø§ÙˆÙ„ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ± Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø«</div>`;
    return;
  }
  resultsTitle.textContent = "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª";
  resultsCount.textContent = list.length;
  list.forEach(p=>{
    const el = document.createElement('div');
    el.className='card';
    el.innerHTML = `
      <img src="${p.img}" alt="${escapeHtml(p.name)}" loading="lazy" />
      <h3>${escapeHtml(p.name)}</h3>
      <p>${escapeHtml(p.type)}</p>
      <div class="price-row">
        <div class="price">${p.price} â‚ª</div>
        <div><button onclick="openDetail(${p.id})">Ø¹Ø±Ø¶</button></div>
      </div>
    `;
    grid.appendChild(el);
  });
}

/* ===== ÙÙ„ØªØ±Ø©/Ø¨Ø­Ø«/ÙØ±Ø² ===== */
function applyFilters(){
  // Ø§Ù„ÙØ¦Ø§Øª
  const checkboxes = document.querySelectorAll('.sidebar input[type="checkbox"]');
  const cats = new Set();
  checkboxes.forEach(ch=>{
    if(ch.checked) cats.add(ch.value);
  });
  state.filters.cats = cats;

  // sort
  const sort = document.querySelector('.sidebar input[name="sort"]:checked').value;
  state.filters.sort = sort;

  // price
  const min = Number(document.getElementById('minPrice').value || 0);
  const max = Number(document.getElementById('maxPrice').value || 100000);
  state.filters.minPrice = min;
  state.filters.maxPrice = max;

  filterAndRender();
}

function resetFilters(){
  document.getElementById('minPrice').value = 0;
  document.getElementById('maxPrice').value = 1000;
  document.querySelectorAll('.sidebar input[type="checkbox"]').forEach(ch=>ch.checked=true);
  document.querySelector('.sidebar input[value="popular"]').checked = true;
  document.getElementById('searchInput').value = "";
  state.filters.q = "";
  applyFilters();
}

function filterAndRender(){
  let out = PRODUCTS.filter(p=>{
    // category
    if(!state.filters.cats.has(p.type)) return false;
    // price range
    if(p.price < state.filters.minPrice || p.price > state.filters.maxPrice) return false;
    // search
    const q = state.filters.q.trim().toLowerCase();
    if(q){
      const hay = (p.name + " " + p.type + " " + p.desc).toLowerCase();
      if(!hay.includes(q)) return false;
    }
    return true;
  });

  // sort
  if(state.filters.sort === "price-asc") out.sort((a,b)=>a.price-b.price);
  else if(state.filters.sort === "price-desc") out.sort((a,b)=>b.price-a.price);
  else out = out; // popular/Ø§Ù„Ø£Ø­Ø¯Ø« â€” keep original order

  renderProducts(out);
}

/* ===== Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ Ù…Ø¹ ØªØ£Ø®ÙŠØ± ØµØºÙŠØ± ===== */
let searchTimer = null;
function debouncedSearch(){
  clearTimeout(searchTimer);
  searchTimer = setTimeout(()=>{ applySearch(); }, 380);
}
function applySearch(){
  state.filters.q = document.getElementById('searchInput').value || "";
  filterAndRender();
}

/* ===== ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ (Ù…ÙˆØ¯Ø§Ù„) ===== */
const overlay = document.getElementById('overlay');
function openDetail(id){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;
  document.getElementById('modalImg').src = p.img;
  document.getElementById('modalTitle').textContent = p.name;
  document.getElementById('modalDesc').textContent = p.desc;
  document.getElementById('modalPrice').textContent = p.price + " â‚ª";
  document.getElementById('modalQty').value = 1;
  overlay.classList.add('visible');
  overlay.setAttribute('aria-hidden','false');
  // save current product id for modal add
  overlay.dataset.productId = id;
}
function closeModal(){ overlay.classList.remove('visible'); overlay.setAttribute('aria-hidden','true'); overlay.dataset.productId=""; }
function modalAddToCart(){
  const id = Number(overlay.dataset.productId);
  const qty = Number(document.getElementById('modalQty').value) || 1;
  if(!id) return;
  const p = PRODUCTS.find(x=>x.id===id);
  addToCart(p, qty);
  closeModal();
}

/* ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø±Ø¨Ø© ===== */
const cartPanel = document.getElementById('cartPanel');
function toggleCart(){
  cartPanel.classList.toggle('visible');
  cartPanel.setAttribute('aria-hidden', cartPanel.classList.contains('visible') ? 'false' : 'true');
}
function updateCartUI(){
  const list = document.getElementById('cartList');
  list.innerHTML = "";
  let total = 0;
  state.cart.forEach(item=>{
    const row = document.createElement('div');
    row.className = 'cart-item';
    row.innerHTML = `
      <img src="${item.img}" alt="${escapeHtml(item.name)}">
      <div style="flex:1">
        <div style="font-weight:700">${escapeHtml(item.name)}</div>
        <div style="color:var(--muted);font-size:0.9rem">${item.price} â‚ª</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
        <div class="qty-controls">
          <button class="small-btn" onclick="changeQty(${item.id}, -1)">-</button>
          <div style="min-width:28px;text-align:center">${item.qty}</div>
          <button class="small-btn" onclick="changeQty(${item.id}, 1)">+</button>
        </div>
        <button class="small-btn" style="background:#ffecec;color:#b33;border-radius:6px" onclick="removeFromCart(${item.id})">Ø­Ø°Ù</button>
      </div>
    `;
    list.appendChild(row);
    total += item.price * item.qty;
  });
  document.getElementById('cartTotal').textContent = total + " â‚ª";
  document.getElementById('cartCount').textContent = state.cart.reduce((s,i)=>s+i.qty,0);
  // small accessibility text
  cartPanel.querySelectorAll('[aria-live]').forEach(n=>n.textContent='');
}

function addToCart(product, qty=1){
  const existing = state.cart.find(i=>i.id===product.id);
  if(existing) existing.qty += qty;
  else state.cart.push({ id:product.id, name:product.name, price:product.price, qty:qty, img:product.img });
  updateCartUI();
  cartPanel.classList.add('visible');
}

/* helpers for buttons in cards (we pass id) */
function openDetailById(id){ openDetail(id); }
function addToCartById(id){
  const p = PRODUCTS.find(x=>x.id===id);
  if(p) addToCart(p,1);
}

function changeQty(id, delta){
  const it = state.cart.find(i=>i.id===id);
  if(!it) return;
  it.qty += delta;
  if(it.qty <= 0) {
    state.cart = state.cart.filter(i=>i.id!==id);
  }
  updateCartUI();
}
function removeFromCart(id){ state.cart = state.cart.filter(i=>i.id!==id); updateCartUI(); }
function clearCart(){ if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ±ÙŠØº Ø§Ù„Ø¹Ø±Ø¨Ø©ØŸ')){ state.cart = []; updateCartUI(); } }

/* checkout (Ù…Ø­Ø§ÙƒØ§Ø©) */
function checkout(){
  if(state.cart.length===0){ alert('Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©'); return; }
  // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¨Ø· Ø¨ÙˆØ§Ø¨Ø© Ø¯ÙØ¹ â€” Ø­Ø§Ù„ÙŠØ§Ù‹ Ù…Ø­Ø§ÙƒØ§Ø©
  const total = state.cart.reduce((s,i)=>s+i.price*i.qty,0);
  const names = state.cart.map(i=>`${i.name} x${i.qty}`).join(", ");
  alert(`Ù…Ø­Ø§ÙƒØ§Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨\nØ§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${names}\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} â‚ª\n(Ù‡Ø°Ù‡ Ù…Ø­Ø§ÙƒØ§Ø© â€” Ù„Ø±Ø¨Ø· Ø§Ù„Ø¯ÙØ¹ ØªØ­ØªØ§Ø¬ Ø®Ø§Ø¯Ù… ÙˆØ¨ÙˆØ§Ø¨Ø© Ø¯ÙØ¹)`);
  // Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØªÙ…Ø§Ù… Ù†Ø±Ù‘ÙÙ‚ ØªÙØ±ÙŠØº Ø§Ù„Ø¹Ø±Ø¨Ø©
  state.cart = [];
  updateCartUI();
}

/* contact modal */
function openContact(){ document.getElementById('contactModal').classList.add('visible'); document.getElementById('contactModal').setAttribute('aria-hidden','false') }
function closeContact(){ document.getElementById('contactModal').classList.remove('visible'); document.getElementById('contactModal').setAttribute('aria-hidden','true') }

/* utility and init */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

function init(){
  renderProducts(PRODUCTS);
  applyFilters(); // to sync UI
  updateCartUI();
}
init();

/* small keyboard accessibility */
document.addEventListener('keydown', e=>{
  if(e.key==='Escape'){
    closeModal();
    closeContact();
  }
});

/* expose small helpers for inline onclick */
window.openDetail = openDetail;
window.addToCart = addToCart;
window.clearCart = clearCart;
window.changeQty = changeQty;
window.removeFromCart = removeFromCart;
window.checkout = checkout;
window.openContact = openContact;
window.closeContact = closeContact;
window.applyFilters = applyFilters;
window.resetFilters = resetFilters;
window.applySearch = applySearch;
</script>
